var XHR,clayPay;(function(n){function u(n){var t=new r;return t.Headers=n.getAllResponseHeaders(),t.Text=n.responseText,t.Type=n.responseType,t.Status=n.status,t.StatusText=n.statusText,t}function t(n,t,i,r=""){return new Promise(function(f,e){var o=new XMLHttpRequest;o.open(n,t);i!=null&&i.forEach(n=>o.setRequestHeader(n.header,n.data));o.onload=()=>{(o.status<200||o.status>=300)&&e(u(o)),f(u(o))};o.onerror=()=>{e("There was an error communicating with the server.  Please check your connection and try again.")};r.length>0?o.send(r):o.send()})}function i(t){return t===null||t.length==0?t=[new n.Header("Content-Type","application/json; charset=utf-8"),new n.Header("Accept","application/json")]:(t.push(new n.Header("Content-Type","application/json; charset=utf-8")),t.push(new n.Header("Accept","application/json"))),t}function e(n,r=null,u=true){return r=u?i(r):r,t("GET",n,r)}function o(n,r="",u=null,f=true){return u=f?i(u):u,t("POST",n,u,r)}function s(n,r="",u=null,f=true){return u=f?i(u):u,t("PUT",n,u,r)}function h(n,r="",u=null,f=true){return u=f?i(u):u,t("DELETE",n,u,r)}function c(t,i=""){var r=n.Get(t+i);return new Promise(function(n,i){r.then(function(t){let i=JSON.parse(t.Text);n(i)}).catch(function(){console.log("error in Get "+t);i(null)})})}function l(t,i=""){var r=n.Get(t+i);return new Promise(function(n,i){r.then(function(t){let i=JSON.parse(t.Text);n(i)}).catch(function(){console.log("error in Get "+t);i(null)})})}function a(t,i){var r=n.Post(t,JSON.stringify(i));return new Promise(function(n,i){r.then(function(t){if(t.Text.length===0)n([]);else{let i=JSON.parse(t.Text);n(i)}}).catch(function(n){console.log("save object error "+t+" "+n);i(null)})})}class f{constructor(n,t){this.header=n;this.data=t}}n.Header=f;class r{}n.Data=r;n.Get=e;n.Post=o;n.Put=s;n.Delete=h;n.GetArray=c;n.GetObject=l;n.SaveObject=a})(XHR||(XHR={})),function(n){"use strict";function t(){i()}function i(){f();u();r();n.UI.BuildCardTypes("ccTypes")}function r(){n.UI.BuildExpMonths("ccExpMonth");n.UI.BuildExpYears("ccExpYear")}function u(){n.transport.GetConvenienceFee().then(function(t){n.ConvenienceFee=t;console.log("conv fee is",t)},function(){console.log("error getting convenience fee")})}function f(){n.transport.GetApplicationTypes().then(function(t){n.UI.BuildAppTypes(t)},function(){console.log("error getting application types")})}function e(t){n.UI.toggleNav("navTopMenu",t);let r=document.getElementsByTagName("section");for(var i=0;i<r.length;i++)r[i].style.display!=="none"&&(r[i].style.display="none");document.getElementById(t).style.display="block"}n.start=t;n.toggleNavDisplay=e}(clayPay||(clayPay={})),function(n){var t;(function(n){"use strict";function t(){var n=XHR.Get("./API/Apptypes/");return new Promise(function(t,i){n.then(function(n){let i=JSON.parse(n.Text);t(i)}).catch(function(){console.log("error in Get Application Types");i(null)})})}function i(){var n=XHR.Get("./API/Fee/");return new Promise(function(t,i){n.then(function(n){let i=JSON.parse(n.Text);t(i)}).catch(function(){console.log("error in Get Convenience Fee");i(null)})})}function r(n){var t=XHR.Get("./API/Query/"+n);return new Promise(function(n,i){t.then(function(t){let i=JSON.parse(t.Text);n(i)}).catch(function(){console.log("error in Get Charges");i(null)})})}n.GetApplicationTypes=t;n.GetConvenienceFee=i;n.GetCharges=r})(t=n.transport||(n.transport={}))}(clayPay||(clayPay={})),function(n){var t;(function(t){"use strict";function it(){ft("btnSubmit");u("errorList");u("PaymentPosting");let s=document.getElementById("paymentForm");if(!s.checkValidity())return!1;let h=r.map(function(n){return n.ItemId}),i=r.reduce((n,t)=>n+t.Total,0);i=parseFloat(i.toFixed(2));let e=new n.CCData(o("ccFirstName"),o("ccLastName"),o("cardNumber"),o("ccTypes"),o("ccExpMonth"),o("ccExpYear"),o("ccCVV"),o("ccZip"),o("emailAddress"),i,h),t=e.Validate();if(t.length===0){u("CCForm");f("PaymentPosting");let n=e.Save();n.then(function(n){let t=JSON.parse(n);rt();ut(t)},function(n){f("errorList");t=[n];w(t);f("CCForm");u("PaymentPosting");l("btnSubmit")})}else f("errorList"),w(t),l("btnSubmit");return!1}function rt(){s=[];r=[];c();tt();let n=document.getElementById("paymentForm");n.reset();l("btnSubmit");f("CCForm");u("PaymentPosting")}function ut(t){n.toggleNavDisplay("receipt");y("receiptUniqueId",t.CashierId);y("receiptTimestamp",t.TimeStamp_Display);y("receiptAmount",t.Amount.toFixed(2))}function p(n,t){document.getElementById(n).disabled=t}function ft(n){p(n,!0)}function l(n){p(n,!1)}function w(n){let t=document.getElementById("errorList"),i=document.createDocumentFragment();e(t);for(let n of n){let t=document.createElement("li");t.textContent=n;i.appendChild(t)}t.appendChild(i)}function o(n){return document.getElementById(n).value}function et(n){let t=document.getElementById("ApplicationTypeSelect");e(t);t.appendChild(h("-1","Select Application Type"));for(let n of n)t.appendChild(h(n.Value,n.Label))}function ot(n){let t=document.getElementById(n);e(t);[{label:"American Express",value:"AMEX"},{label:"Discover",value:"DISCOVER"},{label:"MasterCard",value:"MASTERCARD"},{label:"Visa",value:"VISA"}].map(function(n){t.appendChild(h(n.value,n.label))})}function st(n){let i=document.getElementById(n);i!==undefined&&(e(i),t.ExpMonths.map(function(n){i.appendChild(h(n,n))}))}function ht(n){var u,i;let r=document.getElementById(n);for(e(r),u=(new Date).getFullYear(),i=0;i<10;i++){let n=(u+i).toString();r.appendChild(h(n,n));t.ExpYears.push(n)}}function h(n,t){let i=document.createElement("option");return i.setAttribute("value",n),i.appendChild(document.createTextNode(t)),i}function e(n){while(n.firstChild)n.removeChild(n.firstChild)}function ct(n,t){let r=document.getElementById(n);if(r!==null){let u=r.getElementsByClassName("active");for(var i=0;i<u.length;i++)u[i].classList.remove("active");let f=document.getElementById("nav-"+t);f!==null&&f.classList.add("active")}}function f(n){let t=document.getElementById(n);t.style.display="block"}function u(n){let t=document.getElementById(n);t.style.display="none"}function lt(t){u("InvalidSearch");u("SearchFailed");u("SearchSuccessful");f("SearchResults");f("Searching");let i=t.trim().toUpperCase();if(i.length>0)n.transport.GetCharges(i).then(function(n){return s=n,u("Searching"),at(n,t),!0},function(){return console.log("error getting charges"),u("Searching"),!1});else return u("Searching"),f("InvalidSearch"),!1}function at(n,t){b(n);n.length==0?bt(t):(f("SearchSuccessful"),nt("ChargesKey",n[0].AssocKey),nt("ChargesDetail",n[0].Detail))}function b(n){let i=document.getElementById("Charges"),t=document.createDocumentFragment();e(i);for(let n of n)t.appendChild(yt(n));t.appendChild(vt());i.appendChild(t)}function vt(){let t=document.createDocumentFragment(),r=document.createElement("tr");r.appendChild(i("","",3));r.appendChild(v("Add All to Cart",0,"",!0,pt,a));t.appendChild(r);let u=document.createElement("tr");return u.appendChild(i("","",3)),u.appendChild(wt("View Cart",n.toggleNavDisplay)),t.appendChild(u),t}function yt(n){let t=document.createElement("tr");return t.appendChild(i(n.Description,"left")),t.appendChild(i(n.TimeStampDisplay)),t.appendChild(i(n.Total.toFixed(2))),t.appendChild(v("Add to Cart",n.ItemId,"",!0,k,a)),t}function k(n,t){let i=s.filter(n=>n.ItemId==t);i.length===1&&r.indexOf(i[0])===-1&&r.push(i[0]);d(t);c()}function a(n,t,i){let u=r.filter(n=>n.ItemId!==t);r=u;i&&d(t);c()}function d(n){let t=document.getElementById("btnAdd"+n.toString()),r=document.getElementById("btnRemove"+n.toString()),i=t.style.display==="inline-block";t.style.display=i?"none":"inline-block";r.style.display=i?"inline-block":"none"}function g(n){let t=r.filter(t=>t.ItemId==n);return t.length!==0}function pt(){for(let n of s)g(n.ItemId)||r.push(n);c();b(s)}function i(n,t,i){let r=document.createElement("td");return t!==undefined&&(r.className=t),i!==undefined&&(r.colSpan=i),r.appendChild(document.createTextNode(n)),r}function v(n,t,i,r,u,f){let c=g(t),h=document.createElement("td");h.className=i;let e=document.createElement("button");e.style.display=c?"none":"inline-block";e.type="button";e.id="btnAdd"+t.toString();e.className="btn btn-primary";e.onclick=n=>{u(n,t)};let o=document.createElement("div");o.id="btnRemove"+t.toString();o.style.display=c?"inline-block":"none";o.appendChild(document.createTextNode("Added ("));let s=document.createElement("a");return s,s.style.color="darkgoldenrod",s.style.cursor="pointer",s.appendChild(document.createTextNode("remove")),s.onclick=n=>{f(n,t,r)},o.appendChild(s),o.appendChild(document.createTextNode(")")),e.appendChild(document.createTextNode(n)),h.appendChild(e),h.appendChild(o),h}function wt(n,t){let r=document.createElement("td"),i=document.createElement("button");return i.type="button",i.className="btn btn-success",i.onclick=()=>{t("cart")},i.appendChild(document.createTextNode(n)),r.appendChild(i),r}function y(n,t){let i=document.getElementById(n);i.value=t}function nt(n,t){let i=document.getElementById(n);e(i);i.appendChild(document.createTextNode(t))}function bt(n){let t=document.getElementById("SearchFailed");e(t);let i=document.createElement("h4");i.appendChild(document.createTextNode("No charges were found for search: "+n));t.appendChild(i);f("SearchFailed")}function tt(){let n=document.getElementById("CartNav");e(n);let t=document.createElement("span");if(t.classList.add("glyphicon"),t.classList.add("glyphicon-shopping-cart"),n.appendChild(t),r.length===0){u("CartNotEmpty");f("CartEmpty");n.appendChild(document.createTextNode("Cart: ("));let t=document.createElement("span");t.style.color="darkgoldenrod";t.appendChild(document.createTextNode("empty"));n.appendChild(t);n.appendChild(document.createTextNode(")"))}else f("CartNotEmpty"),u("CartEmpty"),n.appendChild(document.createTextNode("Cart: "+r.length.toString()+(r.length===1?" item":" items")))}function c(){let t=document.getElementById("CartCharges"),n=document.createDocumentFragment();e(t);for(let t of r)n.appendChild(gt(t));n.appendChild(kt());n.appendChild(dt());t.appendChild(n);tt()}function kt(){let n=document.createElement("tr");n.style.fontWeight="bolder";n.appendChild(i("","",2));n.appendChild(i("Total","center",1));let t=r.reduce((n,t)=>n+t.Total,0);return n.appendChild(i(t.toFixed(2),"",1)),n.appendChild(i("","",1)),n}function dt(){let t=document.createElement("tr");return t.style.fontWeight="bolder",t.appendChild(i("Please Note: There is a nonrefundable transaction fee charged by our payment provider. This is charged in addition to the total above.","",2)),t.appendChild(i("Conv. Fee","center",1)),t.appendChild(i(n.ConvenienceFee,"",1)),t.appendChild(i("","",1)),t}function gt(n){let t=document.createElement("tr");return t.appendChild(i(n.AssocKey)),t.appendChild(i(n.Description,"left")),t.appendChild(i(n.TimeStampDisplay,"center")),t.appendChild(i(n.Total.toFixed(2),"center")),t.appendChild(v("Add to Cart",n.ItemId,"center",!0,k,a)),t}let r=[],s=[];t.ExpMonths=["01","02","03","04","05","06","07","08","09","10","11","12"];t.ExpYears=[];t.Submit=it;t.BuildAppTypes=et;t.BuildCardTypes=ot;t.BuildExpMonths=st;t.BuildExpYears=ht;t.clearElement=e;t.toggleNav=ct;t.Search=lt})(t=n.UI||(n.UI={}))}(clayPay||(clayPay={})),function(n){class t{constructor(n,t,i,r,u,f,e,o,s,h,c){this.FirstName=n;this.LastName=t;this.CardNumber=i;this.CardType=r;this.ExpMonth=u;this.ExpYear=f;this.CVVNumber=e;this.ZipCode=o;this.EmailAddress=s;this.Total=h;this.ItemIds=c}Validate(){let t=[];this.FirstName=this.FirstName.trim();this.FirstName.length===0&&t.push("You must enter a First Name.");this.LastName=this.LastName.trim();this.LastName.length===0&&t.push("You must enter a Last Name.");this.CardNumber=this.CardNumber.trim();this.CardNumber.length===0&&t.push("You must enter a Card number.");this.CVVNumber=this.CVVNumber.trim();this.CVVNumber.length===0&&t.push("You must enter a CVC number.");this.ZipCode=this.ZipCode.trim();this.ZipCode.length===0&&t.push("You must enter a Zip Code.");this.EmailAddress=this.EmailAddress.trim();this.EmailAddress.length===0&&t.push("You must enter an Email Address.");(this.ItemIds===null||this.ItemIds.length===0)&&t.push("No items were found in the cart.  Please check this and try again.");if(["AMEX","DISCOVER","MASTERCARD","VISA"].indexOf(this.CardType)===-1&&t.push("An invalid Credit Card Type has been selected."),n.UI.ExpMonths.indexOf(this.ExpMonth)===-1&&t.push("An invalid Expiration Month has been selected."),n.UI.ExpYears.indexOf(this.ExpYear)===-1&&t.push("An invalid Expiration Year has been selected."),n.UI.ExpMonths.indexOf(this.ExpMonth)!==-1&&n.UI.ExpYears.indexOf(this.ExpYear)!==-1){let i=parseInt(this.ExpYear),r=parseInt(this.ExpMonth),u=new Date(i,r-1,1),n=new Date,f=new Date(n.getFullYear(),n.getMonth(),1);u<f&&t.push("The expiration date entered has passed.  Please check it and try again.")}return t}Save(){let n=this;return new Promise(function(t,i){if(n.Validate().length>0)return i(!1);var r=XHR.Put("./API/Pay",JSON.stringify(n));r.then(function(n){return t(n.Text)},function(n){return n.Text.toLowerCase().indexOf("message")?i(JSON.parse(n.Text).Message):i(n.Text)})})}}n.CCData=t}(clayPay||(clayPay={})),function(n){class t{constructor(){this.ItemId=0;this.Description="";this.TimeStampDisplay=""}}n.Charge=t}(clayPay||(clayPay={}));
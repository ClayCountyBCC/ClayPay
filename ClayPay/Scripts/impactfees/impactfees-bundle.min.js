var ImpactFees;(function(n){class t{constructor(){}static Get(n,t=""){let i="?permit_number="+n.trim();return t.length>0&&(i+="&agreement_number="+t),XHR.GetObject("./API/ImpactFees/GetPermit",i)}}n.PermitImpactFee=t})(ImpactFees||(ImpactFees={})),function(n){class t{constructor(){}static LoadBuilders(i,r=-1){let u=i.parentElement;u.classList.add("is-loading");let h=i.id.replace("Add",""),f=document.getElementById("permitBuilderContainer"),e=document.getElementById("permitDeveloperAmount"),o=document.getElementById("permitDeveloperCurrentlyAllocated");if(i.selectedIndex===0){Utilities.Hide(f);o.value="";e.value="";u.classList.remove("is-loading");return}Utilities.Show(f);let s=i.options[i.selectedIndex].value;n.CombinedAllocation.GetAll(s,-1,"").then(function(n){let i=document.getElementById("permitSelectBuilder");if(Utilities.Clear_Element(i),n=n.filter(function(n){return n.Builder_Name.trim().length>0&&n.Builder_Allocation_Amount>0}),n.length>0){e.value=n[0].Agreement_Amount_Formatted;o.value=n[0].Developer_Amount_Currently_Allocated_Formatted;i.add(Utilities.Create_Option("","Select Builder",r===-1));let t=[];for(let n of n)t.indexOf(n.Builder_Id)===-1&&n.Builder_Name.trim()!==""&&(t.push(n.Builder_Id),i.add(Utilities.Create_Option(n.Builder_Id.toString(),n.Builder_Name,n.Builder_Id===r)))}r!==-1&&t.BuilderSelected(i);u.classList.remove("is-loading")}).catch(function(){u.classList.remove("is-loading")})}static Reset(){document.getElementById("formPermitAllocations").reset();document.getElementById("permitSelectAgreement").selectedIndex=0;document.getElementById("permitSelectBuilder").selectedIndex=0;Utilities.Hide(document.getElementById("permitAllocationError"));Utilities.Hide(document.getElementById("permitBuilderContainer"));Utilities.Hide(document.getElementById("permitBuilderSelected"));Utilities.Hide(document.getElementById("permitInfo"));Utilities.Hide(document.getElementById("permitErrorContainer"));Utilities.Hide(document.getElementById("permitSelectDeveloper"))}static BuilderSelected(t){let i=t.parentElement;i.classList.add("is-loading");let h=t.id.replace("Add",""),r=document.getElementById("permitBuilderSelected"),u=document.getElementById("permitBuilderAmount"),f=document.getElementById("permitBuilderCurrentlyAllocated"),o=document.getElementById("permitBuilderAllocationRemaining"),e=document.getElementById("permitCreditAmount");if(e.value="",t.selectedIndex===0){Utilities.Hide(r);i.classList.remove("is-loading");u.value="";f.value="";return}let s=t.options[t.selectedIndex].value;n.CombinedAllocation.GetAll("",parseInt(s),"").then(function(n){u.value=n[0].Builder_Allocation_Amount_Formatted;f.value=n[0].Builder_Amount_Currently_Allocated_Formatted;let t=n[0].Builder_Allocation_Amount-n[0].Builder_Amount_Currently_Allocated,s=document.getElementById("permitRoadImpactFee").value.replace("$","").replace(",",""),h=parseFloat(s);o.value=t.toLocaleString("en-US",{style:"currency",currency:"USD"});e.value=Math.min(h,t).toFixed();i.classList.remove("is-loading");Utilities.Show(r)}).catch(function(){i.classList.remove("is-loading")})}static SearchPermit(){let r=document.getElementById("permitErrorContainer"),u=document.getElementById("permitInfo");Utilities.Hide(r);Utilities.Hide(u);let f=document.getElementById("permitNumber"),i=f.value;if(t.Reset(),f.value=i,i.length!==8){let n=document.getElementById("permitNumberLengthError");Utilities.Error_Show(n);return}if(isNaN(parseInt(i))){let n=document.getElementById("permitNumberNumericError");Utilities.Error_Show(n);return}n.PermitImpactFee.Get(i).then(function(f){let e=document.getElementById("permitRoadImpactFee"),o=document.getElementById("permitContractorNumber"),s=document.getElementById("permitContractorName"),h=document.getElementById("permitCashierId");if(e.value=f.ImpactFee_Amount_Formatted,o.value=f.Contractor_Id,s.value=f.Contractor_Name,h.value=f.Cashier_Id,Utilities.Show(u),f.Error_Text.length>0){let n=document.getElementById("permitErrorText");n.value=f.Error_Text;Utilities.Show(r);return}n.CombinedAllocation.GetAll("",-1,i).then(function(n){let u=document.getElementById("permitSelectDeveloper");Utilities.Show(u);let i=document.getElementById("permitSelectAgreement");if(i.selectedIndex=0,n.length==1){for(var r=0;r<i.options.length;r++)if(i.options.item(r).value===n[0].Agreement_Number){i.selectedIndex=r;break}t.LoadBuilders(i,n[0].Builder_Id)}else n.length===0||console.log("multiple rows returned for this permit number",n)},function(){})},function(){})}static SavePermitAllocation(){let f=document.getElementById("permitNumber"),u=document.getElementById("permitSelectBuilder"),n=document.getElementById("permitCreditAmount");n.classList.remove("is-danger");n.value=parseFloat(n.value).toFixed(2);let r=parseFloat(n.value);if(isNaN(r)||r<0){n.classList.add("is-danger");n.focus();let t=document.getElementById("permitCreditAmountError");Utilities.Error_Show(t);return}let i=new t;i.Amount_Allocated=r;i.Builder_Id=parseInt(u.options[u.selectedIndex].value);i.Permit_Number=f.value.trim();i.Save()}Save(){let n=document.getElementById("permitAllocationError"),i=document.getElementById("permitAllocationErrorList");XHR.SaveObject("./API/ImpactFees/SavePermitAllocation",this).then(function(r){console.log("response",r);r.length>0?(Utilities.Show(n),i.value=r.join("\n")):t.SearchPermit()}).catch(function(t){Utilities.Show(n);i.value=t})}}n.PermitAllocation=t}(ImpactFees||(ImpactFees={})),function(n){function e(){s()}function o(n){let t=document.querySelectorAll("body > section");if(t.length>0)for(let i=0;i<t.length;i++){let r=t.item(i);t.item(i).id===n?(r.classList.remove("hide"),r.classList.add("show")):(r.classList.remove("show"),r.classList.add("hide"))}}function s(){n.CombinedAllocation.GetAll("",-1,"").then(function(t){n.CombinedAllocations=t;h(t);i(f())})}function h(n){let t=[],i=document.getElementById("developerAgreementAdd"),r=document.getElementById("builderAllocationAgreementAdd"),u=document.getElementById("permitSelectAgreement");for(let n of n)if(t.indexOf(n.Agreement_Number)===-1){t.push(n.Agreement_Number);let f=n.Agreement_Number+" - "+n.Developer_Name;i.add(Utilities.Create_Option(n.Agreement_Number,f));n.Agreement_Amount>0&&(r.add(Utilities.Create_Option(n.Agreement_Number,f)),n.Builder_Allocation_Amount>0&&u.add(Utilities.Create_Option(n.Agreement_Number,f)))}}function i(n){let t=document.getElementById("existingAllocationsContainer");Utilities.Clear_Element(t);Utilities.Show(t);t.appendChild(n)}function r(n="",i=""){let r=document.getElementById("breadcrumbs");Utilities.Clear_Element(r);let f=document.createElement("li");r.appendChild(f);let u=document.createElement("a");if(u.href="#",u.appendChild(document.createTextNode("Agreements")),u.onclick=function(){console.log("testing");t("","")},f.appendChild(u),n.length===0)f.classList.add("is-active");else{let f=document.createElement("li"),u=document.createElement("a");if(u.href="#",u.appendChild(document.createTextNode(n)),u.onclick=function(){console.log("testa");t(n,"")},f.appendChild(u),r.appendChild(f),i.length>0){let u=document.createElement("li");u.classList.add("is-active");let f=document.createElement("a");f.appendChild(document.createTextNode(i));f.onclick=function(){console.log("test");t(n,i)};u.appendChild(f);r.appendChild(u)}else f.classList.add("is-active")}}function f(){r();let i=new DocumentFragment,t=document.createElement("table");t.classList.add("table");t.width="100%";let f=document.createElement("thead");f.appendChild(a());let e=document.createElement("tbody"),o=[];for(let n of n.CombinedAllocations)o.indexOf(n.Agreement_Number)===-1&&(o.push(n.Agreement_Number),e.appendChild(u(n.Agreement_Number,"",n.Agreement_Number,n.Developer_Name,n.Agreement_Amount_Formatted,n.Developer_Amount_Currently_Allocated_Formatted)));return t.appendChild(f),t.appendChild(e),i.appendChild(t),i}function t(n,t){n.length>0?t.length>0?i(l(n,t)):i(c(n)):i(f())}function c(t){r(t);let f=new DocumentFragment,i=document.createElement("table");i.classList.add("table");i.width="100%";let e=document.createElement("thead");e.appendChild(v());let o=document.createElement("tbody"),s=[];for(let n of n.CombinedAllocations)n.Agreement_Number===t&&s.indexOf(n.Builder_Name)===-1&&(s.push(n.Builder_Name),o.appendChild(u(n.Agreement_Number,n.Builder_Name,n.Builder_Name,n.Builder_Allocation_Amount_Formatted,n.Builder_Amount_Currently_Allocated_Formatted)));return i.appendChild(e),i.appendChild(o),f.appendChild(i),f}function l(t,i){r(t,i);let e=new DocumentFragment,f=document.createElement("table");f.classList.add("table");f.width="100%";let o=document.createElement("thead");o.appendChild(y());let s=document.createElement("tbody");for(let n of n.CombinedAllocations)n.Agreement_Number===t&&n.Builder_Name===i&&s.appendChild(u(n.Agreement_Number,"",n.Permit_Number,n.Permit_Amount_Allocated.toLocaleString("en-US",{style:"currency",currency:"USD"})));return f.appendChild(o),f.appendChild(s),e.appendChild(f),e}function a(){let n=document.createElement("tr");n.classList.add("tr");let t=document.createElement("th");t.appendChild(document.createTextNode("Agreement Number"));t.width="25%";let i=document.createElement("th");i.appendChild(document.createTextNode("Developer Name"));i.width="25%";let r=document.createElement("th");r.appendChild(document.createTextNode("Agreement Amount"));r.width="25%";let u=document.createElement("th");return u.appendChild(document.createTextNode("Currently Allocated")),u.width="25%",n.appendChild(t),n.appendChild(i),n.appendChild(r),n.appendChild(u),n}function v(){let n=document.createElement("tr");n.classList.add("tr");let t=document.createElement("th");t.appendChild(document.createTextNode("Builder Name"));t.width="33%";let i=document.createElement("th");i.appendChild(document.createTextNode("Amount Allocated"));i.width="33%";let r=document.createElement("th");return r.appendChild(document.createTextNode("Currently Allocated")),r.width="33%",n.appendChild(t),n.appendChild(i),n.appendChild(r),n}function y(){let n=document.createElement("tr");n.classList.add("tr");let t=document.createElement("th");t.appendChild(document.createTextNode("Permit Name"));t.width="50%";let i=document.createElement("th");return i.appendChild(document.createTextNode("Amount Allocated")),i.width="50%",n.appendChild(t),n.appendChild(i),n}function u(n,i,...r){let u=document.createElement("tr");u.classList.add("tr");u.onclick=function(){t(n,i)};for(let n of r){let t=document.createElement("td");t.classList.add("td");t.appendChild(document.createTextNode(n));u.appendChild(t)}return u}n.CombinedAllocations=[];n.Start=e;n.Menu=o;n.View=t}(ImpactFees||(ImpactFees={})),function(n){class t{constructor(){this.Developer_Name="";this.Amount_Currently_Allocated=0;this.Audit_Log=""}static Load(t){let i=t.parentElement;i.classList.add("is-loading");let u=t.id.replace("Add",""),r=document.getElementById(u+"Selected");if(Utilities.Hide(r),t.selectedIndex===0){i.classList.remove("is-loading");return}let f=t.options[t.selectedIndex].value;n.CombinedAllocation.GetAll(f,-1,"").then(function(n){if(n.length>0){let t=n[0],u=document.getElementById("developerAgreementAmount");u.classList.remove("is-danger");let o=document.getElementById("developerCurrentlyAllocated"),s=document.getElementById("developerAgreementAuditLog"),f=document.getElementById("existingDeveloperAgreement"),e=document.getElementById("existingAgreementAmountAllocated");u.value=t.Agreement_Amount.toString();o.value=t.Developer_Amount_Currently_Allocated_Formatted;s.value=t.Developer_Audit_Log;t.Developer_Audit_Log.length===0?(Utilities.Hide(f),Utilities.Hide(e)):(Utilities.Show(f),Utilities.Show(e));Utilities.Show(r);i.classList.remove("is-loading")}}).catch(function(){i.classList.remove("is-loading")})}static SaveAgreement(){let f=document.getElementById("developerAgreementErrorList"),i=document.getElementById("developerAgreementError");Utilities.Hide(i);let r=document.getElementById("developerAgreementAdd"),e=r.options[r.selectedIndex].value,n=document.getElementById("developerAgreementAmount");n.classList.remove("is-danger");let u=parseFloat(n.value);if(!isNaN(u)&&u>=0){let n=new t;n.Agreement_Amount=u;n.Agreement_Number=e;XHR.SaveObject("./API/ImpactFees/SaveDeveloperAgreement",n).then(function(n){console.log("response",n);n.length>0?(Utilities.Show(i),f.value=n.join("\n")):t.Load(r)}).catch(function(n){Utilities.Show(i);f.value=n})}else{n.focus();n.classList.add("is-danger");let t=document.getElementById("developerAgreementAmountError");Utilities.Error_Show(t)}}}n.DeveloperAgreement=t}(ImpactFees||(ImpactFees={})),function(n){class t{constructor(){}static GetAll(n,t,i){let r="";return n.length>0&&(r="&agreementNumber="+n),t!=-1&&(r="&builderId="+t.toString()),i.length>0&&(r="&permitNumber="+i),r.length>0&&(r="?"+r.substr(1)),XHR.GetArray("./API/ImpactFees/GetAgreements",r)}}n.CombinedAllocation=t}(ImpactFees||(ImpactFees={})),function(n){class t{constructor(){this.Amount_Currently_Allocated=0;this.Audit_Log=""}static LoadBuilders(i){let r=i.parentElement;r.classList.add("is-loading");let o=i.id.replace("Add",""),u=document.getElementById(o+"Selected"),f=document.getElementById("builderDeveloperSelectedAmount"),e=document.getElementById("builderDeveloperSelectedCurrentlyAllocated"),s=document.getElementById("builderSelected");if(t.LoadBuilder("","","","$0.00"),Utilities.Hide(s),Utilities.Hide(u),Utilities.Hide(f),Utilities.Hide(e),i.selectedIndex===0){r.classList.remove("is-loading");return}let h=i.options[i.selectedIndex].value;n.CombinedAllocation.GetAll(h,-1,"").then(function(n){let i=document.getElementById("existingBuilders");if(Utilities.Clear_Element(i),n=n.filter(function(n){return n.Builder_Name.trim().length>0}),n.length>0){Utilities.Show(u);Utilities.Show(f);Utilities.Show(e);let r=document.getElementById("buildersDeveloperAgreementAmount"),o=document.getElementById("buildersDeveloperCurrentlyAllocated");r.value=n[0].Agreement_Amount_Formatted;o.value=n[0].Developer_Amount_Currently_Allocated_Formatted;i.add(Utilities.Create_Option("","Select Builder or Add New",!0));let t=[];for(let n of n)t.indexOf(n.Builder_Id)===-1&&n.Builder_Name.trim()!==""&&(t.push(n.Builder_Id),i.add(Utilities.Create_Option(n.Builder_Id.toString(),n.Builder_Name)))}else t.LoadBuilder("","","","$0.00");r.classList.remove("is-loading")}).catch(function(){r.classList.remove("is-loading")})}static LoadSpecificBuilder(i){if(i.selectedIndex===0){t.LoadBuilder("","","","$0.00");return}let r=i.parentElement;r.classList.add("is-loading");let u=parseInt(i.options[i.selectedIndex].value);n.CombinedAllocation.GetAll("",u,"").then(function(n){if(n.length>0){let i=n[0];t.LoadBuilder(i.Builder_Name,i.Builder_Allocation_Amount.toString(),i.Builder_Audit_Log,i.Builder_Amount_Currently_Allocated_Formatted)}r.classList.remove("is-loading")}).catch(function(n){r.classList.remove("is-loading");console.log("Load Specific builder error happened",n)})}static LoadBuilder(n,t,i,r){let f=document.getElementById("builderAllocationName"),e=document.getElementById("builderAllocationAmount"),o=document.getElementById("builderAllocationAuditLog"),s=document.getElementById("buildersAmountAllocatedToPermits"),h=document.getElementById("builderSelected"),u=document.getElementById("existingBuilderAllocation");Utilities.Hide(u);Utilities.Show(h);f.value=n;e.value=t;o.value=i;s.value=r;i.length>0&&Utilities.Show(u)}static AddNewBuilder(){let n=document.getElementById("existingBuilders");n.options.length>0&&(n.selectedIndex=0);t.LoadBuilder("","","","$0.00")}static SaveAllocation(){let f=document.getElementById("builderAllocationError"),s=document.getElementById("builderAllocationErrorList");Utilities.Hide(f);let e=document.getElementById("builderAllocationAgreementAdd"),l=e.options[e.selectedIndex].value,i=document.getElementById("existingBuilders"),h=null;i.options.length>0&&i.selectedIndex>0&&(h=i.options[i.selectedIndex].value);let r=document.getElementById("builderAllocationName"),u=document.getElementById("builderAllocationAmount");u.classList.remove("is-danger");r.classList.remove("is-danger");let o=parseFloat(u.value),c=r.value.trim().toUpperCase();if(c.length<3){r.focus();r.classList.add("is-danger");let n=document.getElementById("builderAllocationNameError");Utilities.Error_Show(n);return}if(isNaN(o)||o<0){u.focus();u.classList.add("is-danger");let n=document.getElementById("builderAllocationAmountError");Utilities.Error_Show(n);return}let n=new t;n.Agreement_Number=l;n.Builder_Name=c;n.Allocation_Amount=o;n.Id=h;XHR.SaveObject("./API/ImpactFees/SaveBuilderAllocation",n).then(function(n){console.log("response",n);n.length>0?(Utilities.Show(f),s.value=n.join("\n")):t.LoadBuilders(e)}).catch(function(n){Utilities.Show(f);s.value=n})}}n.BuilderAllocation=t}(ImpactFees||(ImpactFees={}));
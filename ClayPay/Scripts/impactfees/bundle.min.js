var Utilities,ImpactFees;(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t():typeof define=="function"&&define.amd?define(t):t()})(this,function(){"use strict";function s(){}function h(n,t){return function(){n.apply(t,arguments)}}function n(t){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if(typeof t!="function")throw new TypeError("not a function");this._state=0;this._handled=!1;this._value=undefined;this._deferreds=[];e(t,this)}function f(r,u){while(r._state===3)r=r._value;if(r._state===0){r._deferreds.push(u);return}r._handled=!0;n._immediateFn(function(){var n=r._state===1?u.onFulfilled:u.onRejected,f;if(n===null){(r._state===1?i:t)(u.promise,r._value);return}try{f=n(r._value)}catch(e){t(u.promise,e);return}i(u.promise,f)})}function i(i,u){try{if(u===i)throw new TypeError("A promise cannot be resolved with itself.");if(u&&(typeof u=="object"||typeof u=="function")){var f=u.then;if(u instanceof n){i._state=3;i._value=u;r(i);return}if(typeof f=="function"){e(h(f,u),i);return}}i._state=1;i._value=u;r(i)}catch(o){t(i,o)}}function t(n,t){n._state=2;n._value=t;r(n)}function r(t){t._state===2&&t._deferreds.length===0&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var i=0,r=t._deferreds.length;i<r;i++)f(t,t._deferreds[i]);t._deferreds=null}function c(n,t,i){this.onFulfilled=typeof n=="function"?n:null;this.onRejected=typeof t=="function"?t:null;this.promise=i}function e(n,r){var u=!1;try{n(function(n){u||(u=!0,i(r,n))},function(n){u||(u=!0,t(r,n))})}catch(f){if(u)return;u=!0;t(r,f)}}var o=setTimeout,u;n.prototype["catch"]=function(n){return this.then(null,n)};n.prototype.then=function(n,t){var i=new this.constructor(s);return f(this,new c(n,t,i)),i};n.prototype["finally"]=function(n){var t=this.constructor;return this.then(function(i){return t.resolve(n()).then(function(){return i})},function(i){return t.resolve(n()).then(function(){return t.reject(i)})})};n.all=function(t){return new n(function(n,i){function e(t,u){try{if(u&&(typeof u=="object"||typeof u=="function")){var o=u.then;if(typeof o=="function"){o.call(u,function(n){e(t,n)},i);return}}r[t]=u;--f==0&&n(r)}catch(s){i(s)}}var r,f,u;if(!t||typeof t.length=="undefined")throw new TypeError("Promise.all accepts an array");if(r=Array.prototype.slice.call(t),r.length===0)return n([]);for(f=r.length,u=0;u<r.length;u++)e(u,r[u])})};n.resolve=function(t){return t&&typeof t=="object"&&t.constructor===n?t:new n(function(n){n(t)})};n.reject=function(t){return new n(function(n,i){i(t)})};n.race=function(t){return new n(function(n,i){for(var r=0,u=t.length;r<u;r++)t[r].then(n,i)})};n._immediateFn=typeof setImmediate=="function"&&function(n){setImmediate(n)}||function(n){o(n,0)};n._unhandledRejectionFn=function(n){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",n)};u=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object");}();u.Promise||(u.Promise=n)}),function(n){"use strict";function f(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(n))throw new TypeError("Invalid character in header field name");return n.toLowerCase()}function s(n){return typeof n!="string"&&(n=String(n)),n}function e(n){var t={next:function(){var t=n.shift();return{done:t===undefined,value:t}}};return i.iterable&&(t[Symbol.iterator]=function(){return t}),t}function t(n){this.map={};n instanceof t?n.forEach(function(n,t){this.append(t,n)},this):Array.isArray(n)?n.forEach(function(n){this.append(n[0],n[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(t){this.append(t,n[t])},this)}function o(n){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}function h(n){return new Promise(function(t,i){n.onload=function(){t(n.result)};n.onerror=function(){i(n.error)}})}function b(n){var t=new FileReader,i=h(t);return t.readAsArrayBuffer(n),i}function k(n){var t=new FileReader,i=h(t);return t.readAsText(n),i}function d(n){for(var i=new Uint8Array(n),r=new Array(i.length),t=0;t<i.length;t++)r[t]=String.fromCharCode(i[t]);return r.join("")}function c(n){if(n.slice)return n.slice(0);var t=new Uint8Array(n.byteLength);return t.set(new Uint8Array(n)),t.buffer}function l(){return this.bodyUsed=!1,this._initBody=function(n){if(this._bodyInit=n,n)if(typeof n=="string")this._bodyText=n;else if(i.blob&&Blob.prototype.isPrototypeOf(n))this._bodyBlob=n;else if(i.formData&&FormData.prototype.isPrototypeOf(n))this._bodyFormData=n;else if(i.searchParams&&URLSearchParams.prototype.isPrototypeOf(n))this._bodyText=n.toString();else if(i.arrayBuffer&&i.blob&&p(n))this._bodyArrayBuffer=c(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else if(i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||w(n)))this._bodyArrayBuffer=c(n);else throw new Error("unsupported BodyInit type");else this._bodyText="";this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var n=o(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");else return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var n=o(this);if(n)return n;if(this._bodyBlob)return k(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(d(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");else return Promise.resolve(this._bodyText)},i.formData&&(this.formData=function(){return this.text().then(nt)}),this.json=function(){return this.text().then(JSON.parse)},this}function g(n){var t=n.toUpperCase();return a.indexOf(t)>-1?t:n}function u(n,i){i=i||{};var r=i.body;if(n instanceof u){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url;this.credentials=n.credentials;i.headers||(this.headers=new t(n.headers));this.method=n.method;this.mode=n.mode;r||n._bodyInit==null||(r=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=i.credentials||this.credentials||"omit",(i.headers||!this.headers)&&(this.headers=new t(i.headers)),this.method=g(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function nt(n){var t=new FormData;return n.trim().split("&").forEach(function(n){if(n){var i=n.split("="),r=i.shift().replace(/\+/g," "),u=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(u))}}),t}function tt(n){var i=new t,r=n.replace(/\r?\n[\t ]+/g," ");return r.split(/\r?\n/).forEach(function(n){var t=n.split(":"),r=t.shift().trim(),u;r&&(u=t.join(":").trim(),i.append(r,u))}),i}function r(n,i){i||(i={});this.type="default";this.status=i.status===undefined?200:i.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in i?i.statusText:"OK";this.headers=new t(i.headers);this.url=i.url||"";this._initBody(n)}var i,a,v;if(!n.fetch){if(i={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(n){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n},i.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],p=function(n){return n&&DataView.prototype.isPrototypeOf(n)},w=ArrayBuffer.isView||function(n){return n&&y.indexOf(Object.prototype.toString.call(n))>-1};t.prototype.append=function(n,t){n=f(n);t=s(t);var i=this.map[n];this.map[n]=i?i+","+t:t};t.prototype["delete"]=function(n){delete this.map[f(n)]};t.prototype.get=function(n){return n=f(n),this.has(n)?this.map[n]:null};t.prototype.has=function(n){return this.map.hasOwnProperty(f(n))};t.prototype.set=function(n,t){this.map[f(n)]=s(t)};t.prototype.forEach=function(n,t){for(var i in this.map)this.map.hasOwnProperty(i)&&n.call(t,this.map[i],i,this)};t.prototype.keys=function(){var n=[];return this.forEach(function(t,i){n.push(i)}),e(n)};t.prototype.values=function(){var n=[];return this.forEach(function(t){n.push(t)}),e(n)};t.prototype.entries=function(){var n=[];return this.forEach(function(t,i){n.push([i,t])}),e(n)};i.iterable&&(t.prototype[Symbol.iterator]=t.prototype.entries);a=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];u.prototype.clone=function(){return new u(this,{body:this._bodyInit})};l.call(u.prototype);l.call(r.prototype);r.prototype.clone=function(){return new r(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new t(this.headers),url:this.url})};r.error=function(){var n=new r(null,{status:0,statusText:""});return n.type="error",n};v=[301,302,303,307,308];r.redirect=function(n,t){if(v.indexOf(t)===-1)throw new RangeError("Invalid status code");return new r(null,{status:t,headers:{location:n}})};n.Headers=t;n.Request=u;n.Response=r;n.fetch=function(n,t){return new Promise(function(f,e){var s=new u(n,t),o=new XMLHttpRequest;o.onload=function(){var n={status:o.status,statusText:o.statusText,headers:tt(o.getAllResponseHeaders()||"")},t;n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");t="response"in o?o.response:o.responseText;f(new r(t,n))};o.onerror=function(){e(new TypeError("Network request failed"))};o.ontimeout=function(){e(new TypeError("Network request failed"))};o.open(s.method,s.url,!0);s.credentials==="include"?o.withCredentials=!0:s.credentials==="omit"&&(o.withCredentials=!1);"responseType"in o&&i.blob&&(o.responseType="blob");s.headers.forEach(function(n,t){o.setRequestHeader(t,n)});o.send(typeof s._bodyInit=="undefined"?null:s._bodyInit)})};n.fetch.polyfill=!0}}(typeof self!="undefined"?self:this),function(n){function t(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("hide");n.classList.remove("show");n.classList.remove("show-inline");n.classList.remove("show-flex")}function i(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show-flex")}function c(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function l(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-flex");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show")}function f(n,u,f){var e,o,s;typeof n=="string"&&(n=document.getElementById(n));u&&(r(n),e=document.createElement("div"),e.classList.add("notification"),e.classList.add("is-danger"),o=document.createElement("button"),o.classList.add("delete"),o.onclick=function(){t(n)},e.appendChild(o),Array.isArray(u)?(s=document.createElement("ul"),u.forEach(function(n){var t=document.createElement("li");t.appendChild(document.createTextNode(n));s.appendChild(t)}),e.appendChild(s)):e.appendChild(document.createTextNode(u)),n.appendChild(e));i(n);(f==undefined||f===!0)&&window.setTimeout(function(){t(n)},1e4)}function r(n){if(n!==null&&n!==undefined)while(n.firstChild)n.removeChild(n.firstChild)}function a(n,t,i){i===void 0&&(i=!1);var r=document.createElement("option");return r.value=n,r.text=t,r.selected=i,r}function e(n){return typeof n=="string"&&(n=document.getElementById(n)),n.value}function v(n,t){typeof n=="string"&&(n=document.getElementById(n));n.value=t}function u(n,t){typeof n=="string"&&(n=document.getElementById(n));r(n);n.appendChild(document.createTextNode(t))}function o(n){var u=n.replace("nav-",""),r=document.querySelectorAll("#menuTabs > li > a"),t,i;if(r.length>0)for(t=0;t<r.length;t++)i=r.item(t),i.id===n?i.parentElement.classList.add("is-active"):i.parentElement.classList.remove("is-active");s("#views > section",u)}function s(n,r){var e=document.querySelectorAll(n),u,f;if(e.length>0)for(u=0;u<e.length;u++)f=e.item(u),f.id===r?i(f):t(f)}function y(n){return fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"}).then(function(n){if(!n.ok)throw new Error(n.statusText);return n.json()})}function p(n,t){return fetch(n,{method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){if(console.log("Post Response",n),!n.ok)throw new Error(n.statusText);return n.json()})}function w(n){return n.toLocaleString("en-US",{style:"currency",currency:"USD"})}function b(n){return n instanceof Date?n.toLocaleDateString("en-us"):new Date(n).toLocaleString("en-US")}function k(n,t,i){var r,u;return(typeof n=="string"&&(n=document.getElementById(n)),r=n,r.tagName.toLowerCase()==="select"?r.parentElement.classList.remove("is-danger"):r.classList.remove("is-danger"),u=e(r).trim(),u.length==0)?(r.tagName.toLowerCase()==="select"?r.parentElement.classList.add("is-danger"):r.classList.add("is-danger"),f(t,i),r.focus(),r.scrollTo(),""):u}function d(n,t){typeof n=="string"&&(n=document.getElementById(n));var i=n;i.disabled=t;i.classList.toggle("is-loading",t)}function g(n){var u=document.createElement("li"),t,i,f,o,r,e,s;if(n.selected&&u.classList.add("is-active"),t=document.createElement("a"),t.id=n.id,t.href="#",t.onclick=function(){h(n)},n.icon.length>0){for(i=document.createElement("span"),i.classList.add("icon"),i.classList.add("is-medium"),f=document.createElement("i"),o=n.icon.split(" "),r=0,e=o;r<e.length;r++)s=e[r],f.classList.add(s);i.appendChild(f);t.appendChild(i)}return t.appendChild(document.createTextNode(n.label)),u.appendChild(t),u}function h(n){u("menuTitle",n.title);u("menuSubTitle",n.subTitle);o(n.id)}function nt(){return(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1?"Opera":navigator.userAgent.indexOf("Chrome")!=-1?"Chrome":navigator.userAgent.indexOf("Safari")!=-1?"Safari":navigator.userAgent.indexOf("Firefox")!=-1?"Firefox":navigator.userAgent.indexOf("MSIE")!=-1||!!document.DOCUMENT_NODE==!0?"IE":"unknown"}n.Hide=t;n.Show=i;n.Show_Inline=c;n.Show_Flex=l;n.Error_Show=f;n.Clear_Element=r;n.Create_Option=a;n.Get_Value=e;n.Set_Value=v;n.Set_Text=u;n.Show_Menu=o;n.Show_Hide_Selector=s;n.Get=y;n.Post=p;n.Format_Amount=w;n.Format_Date=b;n.Validate_Text=k;n.Toggle_Loading_Button=d;n.Create_Menu_Element=g;n.Update_Menu=h;n.CheckBrowser=nt}(Utilities||(Utilities={})),function(n){var t=function(){function n(){}return n}();n.PermitWaiver=t}(ImpactFees||(ImpactFees={})),function(n){var t=function(){function n(){}return n.Get=function(n,t,i){var u,f,r;return t===void 0&&(t=""),u="/",f=window.location.pathname.toLowerCase().indexOf("/claypay"),f==0&&(u="/claypay/"),r="?permit_number="+n.trim(),r+="&search_type="+i,t.length>0&&(r+="&agreement_number="+t),Utilities.Get(u+"API/ImpactFees/GetPermit"+r)},n}();n.PermitImpactFee=t}(ImpactFees||(ImpactFees={})),function(n){var t=function(){function t(){}return t.LoadBuilders=function(i,r){var u,s;r===void 0&&(r=-1);u=i.parentElement;u.classList.add("is-loading");var h=i.id.replace("Add",""),f=document.getElementById("permitBuilderContainer"),e=document.getElementById("permitDeveloperAmount"),o=document.getElementById("permitDeveloperCurrentlyAllocated");if(i.selectedIndex===0){Utilities.Hide(f);o.value="";e.value="";u.classList.remove("is-loading");return}Utilities.Show(f);s=i.options[i.selectedIndex].value;n.CombinedAllocation.GetAll(s,-1,"").then(function(n){var f=document.getElementById("permitSelectBuilder"),h,s,c,i;if(Utilities.Clear_Element(f),n=n.filter(function(n){return n.Builder_Name.trim().length>0&&n.Builder_Allocation_Amount>0}),n.length>0)for(e.value=n[0].Agreement_Amount_Formatted,o.value=n[0].Developer_Amount_Currently_Allocated_Formatted,f.add(Utilities.Create_Option("","Select Builder",r===-1)),h=[],s=0,c=n;s<c.length;s++)i=c[s],h.indexOf(i.Builder_Id)===-1&&i.Builder_Name.trim()!==""&&(h.push(i.Builder_Id),f.add(Utilities.Create_Option(i.Builder_Id.toString(),i.Builder_Name,i.Builder_Id===r)));r!==-1&&t.BuilderSelected(f);u.classList.remove("is-loading")}).catch(function(){u.classList.remove("is-loading")})},t.Reset=function(){document.getElementById("formPermitAllocations").reset();document.getElementById("permitSelectAgreement").selectedIndex=0;document.getElementById("permitSelectBuilder").selectedIndex=0;Utilities.Hide(document.getElementById("permitAllocationError"));Utilities.Hide(document.getElementById("permitBuilderContainer"));Utilities.Hide(document.getElementById("permitBuilderSelected"));Utilities.Hide(document.getElementById("permitInfo"));Utilities.Hide(document.getElementById("permitErrorContainer"));Utilities.Hide(document.getElementById("permitSelectDeveloper"))},t.BuilderSelected=function(t){var i=t.parentElement,o;i.classList.add("is-loading");var h=t.id.replace("Add",""),r=document.getElementById("permitBuilderSelected"),u=document.getElementById("permitBuilderAmount"),f=document.getElementById("permitBuilderCurrentlyAllocated"),s=document.getElementById("permitBuilderAllocationRemaining"),e=document.getElementById("permitCreditAmount");if(e.value="",t.selectedIndex===0){Utilities.Hide(r);i.classList.remove("is-loading");u.value="";f.value="";return}o=t.options[t.selectedIndex].value;n.CombinedAllocation.GetAll("",parseInt(o),"").then(function(n){u.value=n[0].Builder_Allocation_Amount_Formatted;f.value=n[0].Builder_Amount_Currently_Allocated_Formatted;var t=n[0].Builder_Allocation_Amount-n[0].Builder_Amount_Currently_Allocated,o=document.getElementById("permitRoadImpactFee").value.replace("$","").replace(",",""),h=parseFloat(o);s.value=t.toLocaleString("en-US",{style:"currency",currency:"USD"});e.value=Math.min(h,t).toFixed();i.classList.remove("is-loading");Utilities.Show(r)}).catch(function(){i.classList.remove("is-loading")})},t.SearchPermit=function(){var r=document.getElementById("permitErrorContainer"),u=document.getElementById("permitErrorText"),f=document.getElementById("permitInfo"),o,s,h;Utilities.Hide(r);Utilities.Hide(f);var e=document.getElementById("permitNumber"),i=e.value.trim(),c=document.querySelector('input[name="searchType"]:checked').value;if(t.Reset(),e.value=i,o=document.querySelector('input[name="searchType"][value="'+c+'"]'),o.checked=!0,i.length!==8){s=document.getElementById("permitNumberLengthError");Utilities.Error_Show(s);return}if(isNaN(parseInt(i))){h=document.getElementById("permitNumberNumericError");Utilities.Error_Show(h);return}n.PermitImpactFee.Get(i,"","IFCR").then(function(e){var o=document.getElementById("permitRoadImpactFee"),s=document.getElementById("permitContractorNumber"),h=document.getElementById("permitContractorName"),c=document.getElementById("permitCashierId");if(o.value=e.ImpactFee_Amount_Formatted,s.value=e.Contractor_Id,h.value=e.Contractor_Name,c.value=e.Cashier_Id,Utilities.Show(f),e.Error_Text.length>0){u.value=e.Error_Text;Utilities.Show(r);return}n.CombinedAllocation.GetAll("",-1,i).then(function(n){var u=document.getElementById("permitSelectDeveloper"),i,r;if(Utilities.Show(u),i=document.getElementById("permitSelectAgreement"),i.selectedIndex=0,n.length==1){for(r=0;r<i.options.length;r++)if(i.options.item(r).value===n[0].Agreement_Number){i.selectedIndex=r;break}t.LoadBuilders(i,n[0].Builder_Id)}else n.length===0||console.log("multiple rows returned for this permit number",n)},function(n){console.log("error",n);u.value=n;Utilities.Show(r)})},function(n){console.log("error",n);u.value=n;Utilities.Show(r)})},t.SearchPermitOther=function(){var i,r,u,t,f,e,o;if(Utilities.Hide("permitOtherApplyWaiver"),i=document.getElementById("permitOtherErrorContainer"),r=document.getElementById("permitOtherErrorText"),Utilities.Hide(i),u=document.getElementById("permitNumberOther"),t=u.value.trim(),u.value=t,t.length!==8){f=document.getElementById("permitNumberOtherLengthError");Utilities.Error_Show(f);return}if(isNaN(parseInt(t))){e=document.getElementById("permitNumberOtherNumericError");Utilities.Error_Show(e);return}o=document.querySelector('input[name="searchType"]:checked').value;n.PermitImpactFee.Get(t,"",o).then(function(n){var u=document.getElementById("permitOtherImpactFee"),t;if(u.value=n.ImpactFee_Amount_Formatted,t=document.getElementById("AmountToWaive"),t.value=n.ImpactFee_Amount.toFixed(2),n.Error_Text.length>0){r.value=n.Error_Text;Utilities.Show(i);return}Utilities.Show("permitOtherApplyWaiver")},function(n){r.value=n;Utilities.Show(i)})},t.SavePermitAllocation=function(){var e=document.getElementById("permitNumber"),u=document.getElementById("permitSelectBuilder"),n=document.getElementById("permitCreditAmount"),r,f,i;if(n.classList.remove("is-danger"),n.value=parseFloat(n.value).toFixed(2),r=parseFloat(n.value),isNaN(r)||r<0){n.classList.add("is-danger");n.focus();f=document.getElementById("permitCreditAmountError");Utilities.Error_Show(f);return}i=new t;i.Amount_Allocated=r;i.Builder_Id=parseInt(u.options[u.selectedIndex].value);i.Permit_Number=e.value.trim();i.Save()},t.SavePermitWaiver=function(){var i,r;Utilities.Toggle_Loading_Button("SavePermitWaiver",!0);var o=document.getElementById("permitNumberOther"),u=document.getElementById("permitOtherErrorContainer"),f=document.getElementById("permitOtherErrorText"),s=document.querySelector('input[name="searchType"]:checked').value,e="/",h=window.location.pathname.toLowerCase().indexOf("/claypay");if(h==0&&(e="/claypay/"),i=new n.PermitWaiver,r=document.getElementById("AmountToWaive").value.trim(),console.log("amount",r),i.Amount=parseFloat(r),isNaN(i.Amount)){alert("There is a problem with the amount entered.  Please check the amount and try again.");return}i.Permit_Number=o.value.trim();i.Waiver_Type=s;Utilities.Post(e+"API/ImpactFees/SavePermitWaiver",i).then(function(n){console.log("response",n);n.length>0&&n!=="success"?(Utilities.Show(u),f.value=n):(t.Reset(),Utilities.Hide("permitCredits"),Utilities.Hide("permitOther"),alert("Successfully applied Waiver/Exemption to Permit: "+i.Permit_Number));Utilities.Toggle_Loading_Button("SavePermitWaiver",!1)}).catch(function(n){Utilities.Show(u);f.value=n;Utilities.Toggle_Loading_Button("SavePermitWaiver",!1)})},t.prototype.Save=function(){var n=document.getElementById("permitAllocationError"),i=document.getElementById("permitAllocationErrorList"),r="/",u=window.location.pathname.toLowerCase().indexOf("/claypay");u==0&&(r="/claypay/");Utilities.Post(r+"API/ImpactFees/SavePermitAllocation",this).then(function(r){console.log("response",r);r.length>0?(Utilities.Show(n),i.value=r.join("\n")):t.SearchPermit()}).catch(function(t){Utilities.Show(n);i.value=t})},t}();n.PermitAllocation=t}(ImpactFees||(ImpactFees={})),function(n){function s(){e();c();b()}function h(){Utilities.Hide("permitOtherApplyWaiver");Utilities.Set_Value("permitNumberOther","");Utilities.Set_Value("permitNumber","");var n=document.querySelector('input[name="searchType"]:checked').value;if(n!==null&&n!==undefined){if(Utilities.Hide("permitCredits"),Utilities.Hide("permitOther"),n==="IFCR"){Utilities.Show("permitCredits");return}Utilities.Show("permitOther")}}function c(){n.CombinedAllocation.GetAll("",-1,"").then(function(t){n.CombinedAllocations=t;l(t);i(f())})}function l(n){for(var t,i,u=[],e=document.getElementById("developerAgreementAdd"),o=document.getElementById("builderAllocationAgreementAdd"),s=document.getElementById("permitSelectAgreement"),r=0,f=n;r<f.length;r++)t=f[r],u.indexOf(t.Agreement_Number)===-1&&(u.push(t.Agreement_Number),i=t.Agreement_Number+" - "+t.Developer_Name,e.add(Utilities.Create_Option(t.Agreement_Number,i)),t.Agreement_Amount>0&&(o.add(Utilities.Create_Option(t.Agreement_Number,i)),t.Builder_Allocation_Amount>0&&s.add(Utilities.Create_Option(t.Agreement_Number,i))))}function i(n){var t=document.getElementById("existingAllocationsContainer");Utilities.Clear_Element(t);Utilities.Show(t);t.appendChild(n)}function r(n,i){var r,e,u,o,f,s,h;n===void 0&&(n="");i===void 0&&(i="");r=document.getElementById("breadcrumbs");Utilities.Clear_Element(r);e=document.createElement("li");r.appendChild(e);u=document.createElement("a");u.href="#";u.appendChild(document.createTextNode("Agreements"));u.onclick=function(){console.log("testing");t("","")};e.appendChild(u);n.length===0?e.classList.add("is-active"):(o=document.createElement("li"),f=document.createElement("a"),f.href="#",f.appendChild(document.createTextNode(n)),f.onclick=function(){console.log("testa");t(n,"")},o.appendChild(f),r.appendChild(o),i.length>0?(s=document.createElement("li"),s.classList.add("is-active"),h=document.createElement("a"),h.appendChild(document.createTextNode(i)),h.onclick=function(){console.log("test");t(n,i)},s.appendChild(h),r.appendChild(s)):o.classList.add("is-active"))}function f(){var e,i,o,s,h,f,c,t;for(r(),e=new DocumentFragment,i=document.createElement("table"),i.classList.add("table"),i.width="100%",o=document.createElement("thead"),o.appendChild(y()),s=document.createElement("tbody"),h=[],f=0,c=n.CombinedAllocations;f<c.length;f++)t=c[f],h.indexOf(t.Agreement_Number)===-1&&(h.push(t.Agreement_Number),s.appendChild(u(t.Agreement_Number,"",t.Agreement_Number,t.Developer_Name,t.Agreement_Amount_Formatted,t.Developer_Amount_Currently_Allocated_Formatted)));return i.appendChild(o),i.appendChild(s),e.appendChild(i),e}function t(n,t){n.length>0?t.length>0?i(v(n,t)):i(a(n)):i(f())}function a(t){var o,f,s,h,c,e,l,i;for(r(t),o=new DocumentFragment,f=document.createElement("table"),f.classList.add("table"),f.width="100%",s=document.createElement("thead"),s.appendChild(p()),h=document.createElement("tbody"),c=[],e=0,l=n.CombinedAllocations;e<l.length;e++)i=l[e],i.Agreement_Number===t&&c.indexOf(i.Builder_Name)===-1&&(c.push(i.Builder_Name),h.appendChild(u(i.Agreement_Number,i.Builder_Name,i.Builder_Name,i.Builder_Allocation_Amount_Formatted,i.Builder_Amount_Currently_Allocated_Formatted)));return f.appendChild(s),f.appendChild(h),o.appendChild(f),o}function v(t,i){var s,f,h,c,o,l,e;for(r(t,i),s=new DocumentFragment,f=document.createElement("table"),f.classList.add("table"),f.width="100%",h=document.createElement("thead"),h.appendChild(w()),c=document.createElement("tbody"),o=0,l=n.CombinedAllocations;o<l.length;o++)e=l[o],e.Agreement_Number===t&&e.Builder_Name===i&&c.appendChild(u(e.Agreement_Number,"",e.Permit_Number,e.Permit_Amount_Allocated.toLocaleString("en-US",{style:"currency",currency:"USD"})));return f.appendChild(h),f.appendChild(c),s.appendChild(f),s}function y(){var n=document.createElement("tr"),t,i,r,u;return n.classList.add("tr"),t=document.createElement("th"),t.appendChild(document.createTextNode("Agreement Number")),t.width="25%",i=document.createElement("th"),i.appendChild(document.createTextNode("Developer Name")),i.width="25%",r=document.createElement("th"),r.appendChild(document.createTextNode("Agreement Amount")),r.width="25%",u=document.createElement("th"),u.appendChild(document.createTextNode("Currently Allocated")),u.width="25%",n.appendChild(t),n.appendChild(i),n.appendChild(r),n.appendChild(u),n}function p(){var n=document.createElement("tr"),t,i,r;return n.classList.add("tr"),t=document.createElement("th"),t.appendChild(document.createTextNode("Builder Name")),t.width="33%",i=document.createElement("th"),i.appendChild(document.createTextNode("Amount Allocated")),i.width="33%",r=document.createElement("th"),r.appendChild(document.createTextNode("Currently Allocated")),r.width="33%",n.appendChild(t),n.appendChild(i),n.appendChild(r),n}function w(){var n=document.createElement("tr"),t,i;return n.classList.add("tr"),t=document.createElement("th"),t.appendChild(document.createTextNode("Permit Name")),t.width="50%",i=document.createElement("th"),i.appendChild(document.createTextNode("Amount Allocated")),i.width="50%",n.appendChild(t),n.appendChild(i),n}function u(n,i){for(var r,f,o,h,e,s=[],u=2;u<arguments.length;u++)s[u-2]=arguments[u];for(r=document.createElement("tr"),r.style.cursor="pointer",r.classList.add("tr"),r.onclick=function(){t(n,i)},f=0,o=s;f<o.length;f++)h=o[f],e=document.createElement("td"),e.classList.add("td"),e.appendChild(document.createTextNode(h)),r.appendChild(e);return r}function e(){for(var i,r=document.getElementById("menuTabs"),n=0,t=o;n<t.length;n++)i=t[n],r.appendChild(Utilities.Create_Menu_Element(i))}function b(){document.getElementById("permitNumberOther").onkeydown=function(t){var i=t||window.event;t.keyCode==13&&n.PermitAllocation.SearchPermitOther()};document.getElementById("permitNumber").onkeydown=function(t){var i=t||window.event;t.keyCode==13&&n.PermitAllocation.SearchPermit()}}n.CombinedAllocations=[];var o=[{id:"nav-existingAllocations",title:"Existing Agreements and Allocations",subTitle:"View the existing allocations by Developer, Builder, or Permit.",icon:"fas fa-home",label:"Current Allocations",selected:!0},{id:"nav-developerAgreement",title:"Developer Agreements",subTitle:"Use this menu to add or make changes to existing developer agreements.",icon:"fas fa-user",label:"Developer",selected:!1},{id:"nav-builderAllocations",title:"Builder Allocations",subTitle:"Use this menu to add or make changes to existing builder allocations.",icon:"fas fa-user",label:"Builder",selected:!1},{id:"nav-permitAllocations",title:"Permit Waivers, Exemptions, and Allocations",subTitle:"Use this menu to add or make changes to existing permit allocations, or to apply waivers or exemptions.",icon:"fas fa-clipboard",label:"Permit",selected:!1}];n.Start=s;n.PermitActionChange=h;n.View=t;n.buildMenuElements=e}(ImpactFees||(ImpactFees={})),function(n){var t=function(){function t(){this.Developer_Name="";this.Amount_Currently_Allocated=0;this.Audit_Log=""}return t.Load=function(t){var i=t.parentElement,u,r,f;if(i.classList.add("is-loading"),u=t.id.replace("Add",""),r=document.getElementById(u+"Selected"),Utilities.Hide(r),t.selectedIndex===0){i.classList.remove("is-loading");return}f=t.options[t.selectedIndex].value;n.CombinedAllocation.GetAll(f,-1,"").then(function(n){var t,u;if(n.length>0){t=n[0];u=document.getElementById("developerAgreementAmount");u.classList.remove("is-danger");var o=document.getElementById("developerCurrentlyAllocated"),s=document.getElementById("developerAgreementAuditLog"),f=document.getElementById("existingDeveloperAgreement"),e=document.getElementById("existingAgreementAmountAllocated");u.value=t.Agreement_Amount.toString();o.value=t.Developer_Amount_Currently_Allocated_Formatted;s.value=t.Developer_Audit_Log;t.Developer_Audit_Log.length===0?(Utilities.Hide(f),Utilities.Hide(e)):(Utilities.Show(f),Utilities.Show(e));Utilities.Show(r);i.classList.remove("is-loading")}}).catch(function(){i.classList.remove("is-loading")})},t.SaveAgreement=function(){var o=document.getElementById("developerAgreementErrorList"),u=document.getElementById("developerAgreementError"),i,r,e,s,h;Utilities.Hide(u);var f=document.getElementById("developerAgreementAdd"),c=f.options[f.selectedIndex].value,n=document.getElementById("developerAgreementAmount");n.classList.remove("is-danger");i=parseFloat(n.value);!isNaN(i)&&i>=0?(r=new t,r.Agreement_Amount=i,r.Agreement_Number=c,e="/",s=window.location.pathname.toLowerCase().indexOf("/claypay"),s==0&&(e="/claypay/"),Utilities.Post(e+"API/ImpactFees/SaveDeveloperAgreement",r).then(function(n){console.log("response",n);n.length>0?(Utilities.Show(u),o.value=n.join("\n")):t.Load(f)}).catch(function(n){console.log("error response",n);Utilities.Show(u);o.value=n})):(n.focus(),n.classList.add("is-danger"),h=document.getElementById("developerAgreementAmountError"),Utilities.Error_Show(h))},t}();n.DeveloperAgreement=t}(ImpactFees||(ImpactFees={})),function(n){var t=function(){function n(){}return n.GetAll=function(n,t,i){var u="/",f=window.location.pathname.toLowerCase().indexOf("/claypay"),r;return f==0&&(u="/claypay/"),r="",n.length>0&&(r="&agreementNumber="+n),t!=-1&&(r="&builderId="+t.toString()),i.length>0&&(r="&permitNumber="+i),r.length>0&&(r="?"+r.substr(1)),Utilities.Get(u+"API/ImpactFees/GetAgreements"+r)},n}();n.CombinedAllocation=t}(ImpactFees||(ImpactFees={})),function(n){var t=function(){function t(){this.Amount_Currently_Allocated=0;this.Audit_Log=""}return t.LoadBuilders=function(i){var r=i.parentElement,o;r.classList.add("is-loading");var s=i.id.replace("Add",""),u=document.getElementById(s+"Selected"),f=document.getElementById("builderDeveloperSelectedAmount"),e=document.getElementById("builderDeveloperSelectedCurrentlyAllocated"),h=document.getElementById("builderSelected");if(t.LoadBuilder("","","","$0.00"),Utilities.Hide(h),Utilities.Hide(u),Utilities.Hide(f),Utilities.Hide(e),i.selectedIndex===0){r.classList.remove("is-loading");return}o=i.options[i.selectedIndex].value;n.CombinedAllocation.GetAll(o,-1,"").then(function(n){var s=document.getElementById("existingBuilders"),l,a,h,o,c,i;if(Utilities.Clear_Element(s),n=n.filter(function(n){return n.Builder_Name.trim().length>0}),n.length>0)for(Utilities.Show(u),Utilities.Show(f),Utilities.Show(e),l=document.getElementById("buildersDeveloperAgreementAmount"),a=document.getElementById("buildersDeveloperCurrentlyAllocated"),l.value=n[0].Agreement_Amount_Formatted,a.value=n[0].Developer_Amount_Currently_Allocated_Formatted,s.add(Utilities.Create_Option("","Select Builder or Add New",!0)),h=[],o=0,c=n;o<c.length;o++)i=c[o],h.indexOf(i.Builder_Id)===-1&&i.Builder_Name.trim()!==""&&(h.push(i.Builder_Id),s.add(Utilities.Create_Option(i.Builder_Id.toString(),i.Builder_Name)));else t.LoadBuilder("","","","$0.00");r.classList.remove("is-loading")}).catch(function(){r.classList.remove("is-loading")})},t.LoadSpecificBuilder=function(i){var r,u;if(i.selectedIndex===0){t.LoadBuilder("","","","$0.00",!1);return}r=i.parentElement;r.classList.add("is-loading");u=parseInt(i.options[i.selectedIndex].value);n.CombinedAllocation.GetAll("",u,"").then(function(n){if(n.length>0){var i=n[0];t.LoadBuilder(i.Builder_Name,i.Builder_Allocation_Amount.toString(),i.Builder_Audit_Log,i.Builder_Amount_Currently_Allocated_Formatted)}r.classList.remove("is-loading")}).catch(function(n){r.classList.remove("is-loading");console.log("Load Specific builder error happened",n)})},t.LoadBuilder=function(n,t,i,r,u){u===void 0&&(u=!0);var o=document.getElementById("builderAllocationName"),s=document.getElementById("builderAllocationAmount"),h=document.getElementById("builderAllocationAuditLog"),c=document.getElementById("buildersAmountAllocatedToPermits"),f=document.getElementById("builderSelected"),e=document.getElementById("existingBuilderAllocation");Utilities.Hide(e);Utilities.Hide(f);u&&Utilities.Show(f);o.value=n;s.value=t;h.value=i;c.value=r;i.length>0&&Utilities.Show(e)},t.AddNewBuilder=function(){var n=document.getElementById("existingBuilders");n.options.length>0&&(n.selectedIndex=0);t.LoadBuilder("","","","$0.00")},t.SaveAllocation=function(){var e=document.getElementById("builderAllocationError"),c=document.getElementById("builderAllocationErrorList"),i,r,f,s,a,v,n,h,y;Utilities.Hide(e);var o=document.getElementById("builderAllocationAgreementAdd"),p=o.options[o.selectedIndex].value,u=document.getElementById("existingBuilders"),l=null;if(u.options.length>0&&u.selectedIndex>0&&(l=u.options[u.selectedIndex].value),i=document.getElementById("builderAllocationName"),r=document.getElementById("builderAllocationAmount"),r.classList.remove("is-danger"),i.classList.remove("is-danger"),f=parseFloat(r.value),s=i.value.trim().toUpperCase(),s.length<3){i.focus();i.classList.add("is-danger");a=document.getElementById("builderAllocationNameError");Utilities.Error_Show(a);return}if(isNaN(f)||f<0){r.focus();r.classList.add("is-danger");v=document.getElementById("builderAllocationAmountError");Utilities.Error_Show(v);return}n=new t;n.Agreement_Number=p;n.Builder_Name=s;n.Allocation_Amount=f;n.Id=l;h="/";y=window.location.pathname.toLowerCase().indexOf("/claypay");y==0&&(h="/claypay/");Utilities.Post(h+"API/ImpactFees/SaveBuilderAllocation",n).then(function(n){console.log("response",n);n.length>0?(Utilities.Show(e),c.value=n.join("\n")):t.LoadBuilders(o)}).catch(function(n){Utilities.Show(e);c.value=n})},t}();n.BuilderAllocation=t}(ImpactFees||(ImpactFees={}));